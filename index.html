<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wastewater 4–20 mA Calculator</title>
<style>
  body {
    background-color: #121212;
    color: #ffffff;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .calculator {
    background-color: #1e1e1e;
    border: 3px solid #ffcc00;
    border-radius: 12px;
    padding: 20px 30px;
    width: 580px;
    box-shadow: 0 0 25px #000;
  }
  h1 {
    color: #ffcc00;
    text-align: center;
    margin-bottom: 15px;
  }
  .row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 6px 0;
  }
  label {
    flex: 1;
    color: #ffcc00;
    font-weight: bold;
  }
  input, select {
    flex: 1;
    padding: 6px 8px;
    background-color: #2b2b2b;
    border: 1px solid #ffcc00;
    border-radius: 4px;
    color: #ffffff;
    font-size: 1em;
    text-align: right;
  }
  button {
    width: 100%;
    background-color: #ffcc00;
    border: none;
    padding: 10px;
    font-weight: bold;
    font-size: 1em;
    margin-top: 12px;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background-color: #ffe066; }
  .slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
  }
  #valueSlider {
    flex: 1;
    -webkit-appearance: none;
    height: 10px;
    background: #ffcc00;
    border-radius: 5px;
    outline: none;
  }
  #valueSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: #00ff88;
    border-radius: 50%;
    border: 2px solid #ffcc00;
    cursor: pointer;
  }
  #valueSlider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: #00ff88;
    border-radius: 50%;
    border: 2px solid #ffcc00;
    cursor: pointer;
  }
  .slider-labels {
    display: flex;
    justify-content: space-between;
    color: #ffcc00;
    font-weight: bold;
    font-size: 0.85em;
    margin-top: 2px;
  }
  .result {
    text-align: center;
    font-size: 1.4em;
    font-weight: bold;
    color: #00ff88;
    margin-top: 15px;
  }
  footer {
    text-align: center;
    font-size: 0.8em;
    color: #888;
    margin-top: 10px;
  }
</style>
</head>
<body>
<div class="calculator">
  <h1>Wastewater 4–20 mA Calculator</h1>

  <div class="row">
    <label for="mode">Mode:</label>
    <select id="mode" onchange="updateMode()">
      <option value="maToEng">mA → Engineering Units</option>
      <option value="engToMa">Engineering Units → mA</option>
    </select>
  </div>

  <div class="row">
    <label for="preset">Preset:</label>
    <select id="preset" onchange="applyPreset()">
      <option value="custom">Custom</option>
      <option value="flow">Flow (0–1000 GPM)</option>
      <option value="level">Level (0–15 ft)</option>
      <option value="pressure">Pressure (0–100 psi)</option>
      <option value="do">DO (0–20 mg/L)</option>
      <option value="turbidity">Turbidity (0–500 NTU)</option>
      <option value="ph">pH (0–14)</option>
      <option value="percent">Percent Full (0–100 %)</option>
    </select>
  </div>

  <div class="row"><label>Input Min (mA):</label><input id="inputMin" type="number" value="4" step="any" oninput="updateSliderLimits()"></div>
  <div class="row"><label>Input Max (mA):</label><input id="inputMax" type="number" value="20" step="any" oninput="updateSliderLimits()"></div>
  <div class="row"><label>Output Min:</label><input id="outputMin" type="number" value="0" step="any"></div>
  <div class="row"><label>Output Max:</label><input id="outputMax" type="number" value="100" step="any"></div>

  <div class="row">
    <label id="valueLabel">Value:</label>
    <input id="valueInput" type="number" value="12" step="any">
  </div>

  <div class="slider-container">
    <input type="range" id="valueSlider" min="4" max="20" step="0.01" value="12">
    <span id="sliderDisplay">12</span>
  </div>
  <div class="slider-labels">
    <span id="sliderMin">4</span>
    <span id="sliderMid">12</span>
    <span id="sliderMax">20</span>
  </div>

  <button onclick="calculate()">Calculate</button>
  <div class="result" id="result">Result: —</div>
  <footer>Formula: (Value – Min) × ((OutMax – OutMin)/(InMax – InMin)) + OutMin</footer>
</div>

<script>
const slider = document.getElementById("valueSlider");
const sliderDisplay = document.getElementById("sliderDisplay");
const valueInput = document.getElementById("valueInput");
const modeSelect = document.getElementById("mode");
const valueLabel = document.getElementById("valueLabel");

function updateSliderLimits(){
  const min = parseFloat(document.getElementById("inputMin").value);
  const max = parseFloat(document.getElementById("inputMax").value);
  slider.min = min;
  slider.max = max;
  if(slider.value < min) slider.value = min;
  if(slider.value > max) slider.value = max;
  sliderDisplay.textContent = parseFloat(slider.value).toFixed(2);
  calculate();
}

slider.addEventListener("input", ()=>{
  valueInput.value = parseFloat(slider.value).toFixed(2);
  sliderDisplay.textContent = parseFloat(slider.value).toFixed(2);
  calculate();
});

valueInput.addEventListener("input", ()=>{
  slider.value = parseFloat(valueInput.value);
  sliderDisplay.textContent = parseFloat(valueInput.value).toFixed(2);
  calculate();
});

function applyPreset(){
  const preset = document.getElementById("preset").value;
  const oMin = document.getElementById("outputMin");
  const oMax = document.getElementById("outputMax");
  switch(preset){
    case "flow": oMin.value=0;oMax.value=1000; break;
    case "level": oMin.value=0;oMax.value=15; break;
    case "pressure": oMin.value=0;oMax.value=100; break;
    case "do": oMin.value=0;oMax.value=20; break;
    case "turbidity": oMin.value=0;oMax.value=500; break;
    case "ph": oMin.value=0;oMax.value=14; break;
    case "percent": oMin.value=0;oMax.value=100; break;
    default: break;
  }
  calculate();
}

function updateMode(){
  const mode = modeSelect.value;
  if(mode === "maToEng"){
    valueLabel.textContent = "mA Input:";
  } else {
    valueLabel.textContent = "Engineering Units:";
  }
  calculate();
}

function calculate(){
  const inMin = parseFloat(document.getElementById("inputMin").value);
  const inMax = parseFloat(document.getElementById("inputMax").value);
  const outMin = parseFloat(document.getElementById("outputMin").value);
  const outMax = parseFloat(document.getElementById("outputMax").value);
  const val = parseFloat(valueInput.value);
  const mode = modeSelect.value;

  if(mode === "maToEng"){
    const result = (val-inMin)*(outMax-outMin)/(inMax-inMin)+outMin;
    document.getElementById("result").textContent = `Result: ${result.toFixed(3)} units`;
  } else {
    const result = (val-outMin)*(inMax-inMin)/(outMax-outMin)+inMin;
    document.getElementById("result").textContent = `Result: ${result.toFixed(3)} mA`;
    slider.value = result;
    sliderDisplay.textContent = result.toFixed(2);
  }
}

// Initialize
updateSliderLimits();
applyPreset();
calculate();
</script>
</body>
</html>
